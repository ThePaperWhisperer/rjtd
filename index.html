<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WarTD</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
</head>

<body>
    <style>
        body {
            background: green;
            perspective: 500px;
            overflow: hidden;
        }

        #home {
            position: absolute;
            transform-style: preserve-3d;
            scale: 5 5 5;
            top: 300px;
            translate: 500px -20vh 300px;
        }

        #enemy {
            position: absolute;
            transform-style: preserve-3d;
            scale: 5 5 5;
            top: 300px;
            translate: 500px 0px -1000px;
        }

        progress {
            position: absolute;
            z-index: 10;
            height: 50px;
            width: 40vw;
        }

        #eh {
            position: absolute;
            z-index: 12;
            color: black;
            left: 20vw;
        }

        #yh {
            position: absolute;
            z-index: 12;
            color: black;
            left: 60vw;
        }

        #health {
            left: 40vw;
        }
    </style>
    <p id="eh">Enemy Health</p>
    <p id="yh">Health</p>
    <progress id="enemyhealth" max="100" value="100"></progress>
    <progress id="health" max="100" value="100"></progress>
    <model-viewer id="home" src="newscene.glb"></model-viewer>
    <model-viewer id="enemy" src="newscene.glb"></model-viewer>
    <model-viewer id="tower" src="tower.glb"></model-viewer>
    <model-viewer id="etower" src="Fire.glb"></model-viewer>
    <script>
        var w;
        var exp = 0;
        var tower = document.getElementById("tower");
        tower.style.position = "absolute";
        tower.style.width = "50px";
        tower.style.height = "500px";
        tower.style.translate = "0px 0px 0px"
        tower.style.transformStyle = "preserve-3d"
        var e1health = 100;
        var etower = document.getElementById("etower");
        etower.style.position = "absolute";
        etower.style.width = "50px";
        var etimeoff = 20000
        etower.style.height = "500px";
        etower.style.translate = "0px 0px -650px"
        etower.style.transformStyle = "preserve-3d"
        var options = ["fire", "water"];
        var back = false;
        var health = 100;
        var t1 = options[Math.floor(Math.random() * options.length)];
        alert("Tower one is " + t1 + ".");
        function isCollide(a, b) {
            a = a.getBoundingClientRect();
            b = b.getBoundingClientRect();
            return !(
                ((a.x + a.width) < b.x) ||
                (a.x > (b.x + b.width))
            );
        }
        setTimeout(shootenemy, etimeoff)
        var firemove = 0;
        var wave = false;
        var firemovee = -650;
        var efire;
        function shootenemy() {
            efire = new Image(200, 200);
            efire.src = "fire.png";
            efire.style.position = "absolute"
            document.body.appendChild(efire);
            firem();
            function firem() {
                if (firemovee <= 0 && wave == false) {
                    console.log(isCollide(efire, tower));
                    firemovee++;
                    efire.style.translate = "0px 0px " + firemovee + "px";
                    requestAnimationFrame(firem);
                }
                else if (wave == false) {
                    firemovee = -650;
                    if (isCollide(efire, tower)) {
                        health -= 2;
                        document.getElementById("health").value -= 2;
                        efire.remove();
                    }

                }
            }
            setTimeout(shootenemy, etimeoff)
        }
        var fire;
        function shoot2(tow, dam) {
            if (tow === "fire") {
                fire = new Image(200, 200);
                fire.src = "fire.png";
                fire.style.position = "absolute"
                document.body.appendChild(fire);
                function firem() {
                    firemove -= 10;
                    exp += 10;
                  
                    document.onmousemove = (e) => {
                        fire.style.translate = e.clientX + "px 0px " + firemove + "px";
                    }
                    if (firemove > -650) {
                        requestAnimationFrame(firem);
                    }
                    else {
                        firemove = 0;
                        if (isCollide(fire, etower)) {
                            e1health -= dam;
                            document.getElementById("enemyhealth").value -= dam;

                        }
                        fire.remove();
                    }
                }
                requestAnimationFrame(firem);
            }
        }
        function shoot(tow, dam) {
            if (tow === "fire") {
                fire = new Image(200, 200);
                fire.src = "fire.png";
                fire.style.position = "absolute"
                document.body.appendChild(fire);
                function firem() {
                    firemove -= 10;
                    exp += 10;
                    if (exp === 10000) {
                        exp = 0;
                        alert("You got a new Tower! Click the tower you want to use currently to control it!");
                        if (t1 === "fire") {
                            t2 = water;
                            var tow2 = tower.cloneNode(true);
                            tow2.style.position = "absolute";
                            tow2.style.width = "50px";
                            tow2.style.height = "500px";
                            tow2.style.translate = "500px 0px 0px"
                            tow2.style.transformStyle = "preserve-3d"
                            tow2.src = "Water.glb";
                            document.body.appendChild(tow2);
                            if (document.activeElement === tow2) {
                                var time = 20000;
                                var timeoff = 10000;
                                var poison = false;
                                var able = false;
                                setTimeout(() => {
                                    able = true;
                                }, timeoff);
                                document.onkeydown = (e) => {
                                    if (e.key === " " && able == true) {
                                        able = false;
                                        defend(time);
                                        setTimeout(() => {
                                            able = true;
                                        }, timeoff);

                                    }
                                    if (e.key === "a" && able == true) {
                                        able = false;
                                        attack();
                                        setTimeout(() => {
                                            able = true;
                                        }, timeoff);

                                    }
                                    if (e.key === "r" && able == true) {
                                        tower.ondrag = (e) => {
                                            tower.style.left = e.clientX + "px";
                                        }
                                        setTimeout(() => {
                                            able = true;
                                        }, timeoff);

                                    }
                                }
                                setTimeout(shoot, 10000, t1, 2);
                            }
                            else{
                                setTimeout(defend2, 10000, time)
                                setTimeout(attack2, 10000)
                            }
                        }
                        else if (t1 === "water") {
                            t2 = fire;
                            var tow2 = tower.cloneNode(true);
                            tow2.style.position = "absolute";
                            tow2.style.width = "50px";
                            tow2.style.height = "500px";
                            tow2.style.translate = "500px 0px 0px"
                            tow2.style.transformStyle = "preserve-3d"
                            tow2.src = "Fire.glb";
                            document.body.appendChild(tow2);
                            if (document.activeElement === tow2) {
                                var damage = 2;
            var timeoff = 10000;
            var poison = false;
            var able = true;
            document.onkeydown = (e) => {
                if (e.key === " " && able == true) {
                    able = false;
                    shoot(t1, damage);
                    setTimeout(() => {
                        able = true;
                    }, timeoff);

                }
                if (e.key === "r" && able == true) {
                    able = false;
                    tower.ondrag = (e) => {
                        tower.style.left = e.clientX;
                    }
                    setTimeout(() => {
                        able = true;
                    }, timeoff);

                }
            }
            setTimeout(defend2, 10000, 20000);
            setTimeout(attack2, 200000)
                                                            }
                            else{
                                setTimeout(shoot2, 10000, t2, damage)
                            }
                        }
                    }
                    document.onmousemove = (e) => {
                        fire.style.translate = e.clientX + "px 0px " + firemove + "px";
                    }
                    if (firemove > -650) {
                        requestAnimationFrame(firem);
                    }
                    else {
                        firemove = 0;
                        if (isCollide(fire, etower)) {
                            e1health -= dam;
                            document.getElementById("enemyhealth").value -= dam;

                        }
                        fire.remove();
                    }
                }
                requestAnimationFrame(firem);
            }
        }
        var watermove = 0;
        var wx = 0;
        function attack() {
            fire = new Image(200, 200);
            fire.src = "water.png";
            fire.style.position = "absolute"
            document.body.appendChild(fire);
            function firem() {
                watermove -= 10;
                document.onmousemove = (e) => {
                    fire.style.translate = e.clientX + "px 0px " + watermove + "px";
                }
                if (watermove > -650) {
                    requestAnimationFrame(firem);
                }
                else {
                    watermove = 0;
                    if (isCollide(fire, etower)) {
                        e1health--;
                        document.getElementById("enemyhealth").value--;

                    }
                    fire.remove();
                }
            }
            requestAnimationFrame(firem);
        }
        function attack2() {
            fire = new Image(200, 200);
            fire.src = "water.png";
            fire.style.position = "absolute"
            document.body.appendChild(fire);
            function firem() {
                watermove -= 10;
                document.onmousemove = (e) => {
                    fire.style.translate = e.clientX + "px 0px " + watermove + "px";
                }
                if (watermove > -650) {
                    requestAnimationFrame(firem);
                }
                else {
                    watermove = 0;
                    if (isCollide(fire, etower)) {
                        e1health--;
                        document.getElementById("enemyhealth").value--;
                        if(document.activeElement === tower){
                            setTimeout(attack2, 10000)
                        }
                    }
                    fire.remove();
                }
            }
            requestAnimationFrame(firem);
        }
        function defend(tim) {
            wave = true;
            alert("Enemy stunned for " + tim / 1000 + " seconds.")
            setTimeout(() => {
                wave = false;
            }, tim)

        }
        function defend2(tim) {
            wave = true;
            alert("Enemy stunned for " + tim / 1000 + " seconds.")
            setTimeout(() => {
                wave = false;
            }, tim)
            if(document.activeElement === tower){
                setTimeout(defend2, 10000, tim)
            }
        }
        if (t1 === "fire") {
            var damage = 2;
            tower.src = "Fire.glb"
            var timeoff = 10000;
            var poison = false;
            var able = true;
            document.onkeydown = (e) => {
                if (e.key === " " && able == true) {
                    able = false;
                    shoot(t1, damage);
                    setTimeout(() => {
                        able = true;
                    }, timeoff);

                }
                if (e.key === "r" && able == true) {
                    able = false;
                    tower.ondrag = (e) => {
                        tower.style.left = e.clientX;
                    }
                    setTimeout(() => {
                        able = true;
                    }, timeoff);

                }
            }
        }
        if (t1 === "water") {
            tower.src = "Water.glb"
            var time = 20000;
            var timeoff = 10000;
            var poison = false;
            var able = false;
            setTimeout(() => {
                able = true;
            }, timeoff);
            document.onkeydown = (e) => {
                if (e.key === " " && able == true) {
                    able = false;
                    defend(time);
                    setTimeout(() => {
                        able = true;
                    }, timeoff);

                }
                if (e.key === "a" && able == true) {
                    able = false;
                    attack();
                    setTimeout(() => {
                        able = true;
                    }, timeoff);

                }
                if (e.key === "r" && able == true) {
                    tower.ondrag = (e) => {
                        tower.style.left = e.clientX + "px";
                    }
                    setTimeout(() => {
                        able = true;
                    }, timeoff);

                }
            }
        }
    </script>
</body>

</html>