<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WarTD</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
</head>

<body>
    <style>
        body {
            background: green;
            perspective: 500px;
            overflow: hidden;
        }

        #home {
            position: absolute;
            transform-style: preserve-3d;
            scale: 5 5 5;
            top: 300px;
            translate: 500px -20vh 300px;
        }

        #enemy {
            position: absolute;
            transform-style: preserve-3d;
            scale: 5 5 5;
            top: 300px;
            translate: 500px 0px -1000px;
        }
        progress{
            position: absolute;
            z-index: 10;
            height: 50px; 
            width: 40vw;
        }
        #eh{
            position: absolute;
            z-index: 12;
            color: black;
            left: 20vw;
        }
        #yh{
            position: absolute;
            z-index: 12;
            color: black;
            left: 60vw;
        }
        #health{
            left: 40vw; 
        }
    </style>
    <p id="eh">Enemy Health</p>
    <p id="yh">Health</p>
    <progress id="enemyhealth" max="100" value="100"></progress>
    <progress id="health" max="100" value="100"></progress>
    <model-viewer id="home" src="newscene.glb"></model-viewer>
    <model-viewer id="enemy" src="newscene.glb"></model-viewer>
    <model-viewer id="tower" src="tower.glb"></model-viewer>
    <model-viewer id="etower" src="tower.glb"></model-viewer>
    <script>
        var tower = document.getElementById("tower");
        tower.style.position = "absolute";
        tower.style.width = "50px";
        tower.style.height = "500px";
        tower.style.translate = "0px 0px 0px"
        tower.style.transformStyle = "preserve-3d"
        var e1health = 100;
        var etower = document.getElementById("etower");
        etower.style.position = "absolute";
        etower.style.width = "50px";
        etower.style.height = "500px";
        etower.style.translate = "0px 0px -650px"
        etower.style.transformStyle = "preserve-3d"
        var options = ["fire", "water"];
        var back = false;
        var health = 100;
        var t1 = options[Math.floor(Math.random() * options.length)];
        alert("Tower one is " + t1 + ".");
        function isCollide(a, b) {
            a = a.getBoundingClientRect();
            b = b.getBoundingClientRect();
            return !(
                ((a.x + a.width) < b.x) ||
                (a.x > (b.x + b.width))
            );
        }
        setTimeout(shootenemy, 10000)
        var firemove = 0;
        var wave = false;
var firemovee = -650;
        function shootenemy() {
                var fire = new Image(200, 200);
                fire.src = "fire.png";
                fire.style.position = "absolute"
                document.body.appendChild(fire);
                function firem() {
                   
                    if (firemovee < 0 && !wave) {
                        firemovee += 10;
                        fire.style.translate = "0px 0px " + firemovee + "px";
                        requestAnimationFrame(firem);
                    }
                    else if (wave && firemovee > -650){
                        firemovee -= 10;
                        fire.style.translate = "0px 0px " + firemovee + "px";
                        requestAnimationFrame(firem);
                    }
                    else {
                        firemovee = -650;
                        if(isCollide(fire, tower)){
                            health-=2;
                            document.getElementById("health").value-=2;
                        }
                        fire.remove();
                    }
                }
        setTimeout(shootenemy, 10000)
        }
        function shoot(tow, dam) {
            if (tow === "fire") {
                var fire = new Image(200, 200);
                fire.src = "fire.png";
                fire.style.position = "absolute"
           document.body.appendChild(fire);
                function firem() {
                    firemove -= 10;
                    document.onmousemove = (e)=> {
                        fire.style.translate = e.clientX + "px 0px " + firemove + "px";
                    }
                    if (firemove > -650) {
                        requestAnimationFrame(firem);
                    }
                    else {
                        firemove = 0;
                        if(isCollide(fire, etower)){
                            e1health-=dam;
                            document.getElementById("enemyhealth").value-=dam;

                        }
                        fire.remove();
                    }
                }
                requestAnimationFrame(firem);
            }
        }
         var wx = 0;
        function defend(dam){

            var w = new Image(200, 200);
            w.src = "water.png";
            w.style.position = "absolute";
            function wmove(){
               wx-=20;
                if(isCollide(w, etower) == false){
                    w.style.translate = "0px 0px "+ wx + "px";
                    requestAnimationFrame(wmove);
                }
                else{
                    wx = 0;
                    wave = true;           
                    w.remove();
                }
            }
            
        }
        if (t1 === "fire") {
            var damage = 2;
            var timeoff = 10000;
            var poison = false;
            var able = false;
            setTimeout(() => {
                able = true;
            }, timeoff);
            document.onkeydown = (e) => {
                if (e.key === " " && able == true) {
                    shoot(t1, damage);
                    setTimeout(() => {
                        able = true;
                    }, timeoff);

                }
                if(e.key === "r" && able === true){
                    tower.ondrag = (e)=> {
                        tower.style.left = e.clientX;
                    }
            }
        }
    }
        if (t1 === "water") {
            var damage = 2;
            var timeoff = 10000;
            var poison = false;
            var able = false;
            var rebound = 8;
            setTimeout(() => {
                able = true;
            }, timeoff);
            document.onkeydown = (e) => {
                if (e.key === " " && able == true) {
                    able = false;
                    defend(damage);
                    setTimeout(() => {
                        able = true;
                    }, timeoff);

                }
                if(e.key === "r" && able === true){
                    tower.ondrag = (e)=> {
                        tower.style.left = e.clientX + "px";
                    }
                }
            }
        }
    </script>
</body>

</html>