<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WarTD</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
</head>

<body>
    <style>
        body {
            background: green;
            perspective: 500px;
            overflow: hidden;
        }

        #home {
            position: absolute;
            transform-style: preserve-3d;
            scale: 5 5 5;
            top: 300px;
            translate: 500px -20vh 300px;
        }

        #enemy {
            position: absolute;
            transform-style: preserve-3d;
            scale: 5 5 5;
            top: 300px;
            translate: 500px 0px -1000px;
        }
    </style>
    <model-viewer id="home" src="newscene.glb"></model-viewer>
    <model-viewer id="enemy" src="newscene.glb"></model-viewer>
    <model-viewer id="tower" src="tower.glb"></model-viewer>
    <model-viewer id="etower" src="tower.glb"></model-viewer>
    <script>
        var tower = document.getElementById("tower");
        tower.style.position = "absolute";
        tower.style.height = "500px";
        tower.style.transformStyle = "preserve-3d"
        var e1health = 100;
        var etower = document.getElementById("etower");
        etower.style.position = "absolute";
        etower.style.height = "500px";
        etower.style.translate = "0px 0px -650px"
        etower.style.transformStyle = "preserve-3d"
        var options = ["fire", "wind"];
        var back = false;
        var health = 100;
        var t1 = options[Math.floor(Math.random() * options.length)];
        alert("Tower one is " + t1 + ".");
        function isCollide(a, b) {
            return !(
                ((a.y + a.height) < (b.y)) ||
                (a.y > (b.y + b.height)) ||
                ((a.x + a.width) < b.x) ||
                (a.x > (b.x + b.width))
            );
        }
        setTiemout(shootenemy, 10000)
        var firemove = 0;
var firemovee = 1000;
        function shootenemy() {
                var fire = new Image(200, 200);
                fire.src = "fire.png";
                document.body.appendChild(fire);
                function firem() {
                    if(!back){
                    firemovee += 10;
                        fire.style.translate = "0px 0px " + firemovee + "px";
                    if (firemovee < 0) {
                        requestAnimationFrame(firem);
                    }
                    else {
                        firemovee = 0;
                        if(isCollide(fire, tower)){
                            health-=2;
                            alert("One of your towers has " + health + " health left.")
                        }
                        fire.remove();
                    }
                }
                else{
                    firemovee -= 10;
                        fire.style.translate = "0px 0px " + firemovee + "px";
                    
                    if (firemovee >-1000) {
                        requestAnimationFrame(firem);
                    }
                    else {
                        firemovee = 0;
                        if(isCollide(fire, etower)){
                            e1health-=2;
                            alert("An enemy tower has " + e1health + " health left.")
                        }
                        fire.remove();
                    }
                }
                requestAnimationFrame(firem);
            }
        setTimeout(shootenemy, 10000)
        }
        function shoot(tow, dam) {
            if (tow === "fire") {
                var fire = new Image(200, 200);
                fire.src = "fire.png";
                document.body.appendChild(fire);
                function firem() {
                    firemove -= 10;
                    document.onmousemove = (e)=> {
                        fire.style.translate = e.clientX + "px 0px " + firemove + "px";
                    }
                    if (firemove > -1000) {
                        requestAnimationFrame(firem);
                    }
                    else {
                        firemove = 0;
                        if(isCollide(fire, etower)){
                            e1health-=dam;
                            alert("An enemy's tower has " + e1health + " health left.")
                        }
                        fire.remove();
                    }
                }
                requestAnimationFrame(firem);
            }
        }
        function defend(reb){
            if(Math.floor(Math.random()* reb) === 1){
                back = true;
            }
        }
        if (t1 === "fire") {
            var damage = 2;
            var timeoff = 10000;
            var poison = false;
            var able = false;
            setTimeout(() => {
                able = true;
            }, timeoff);
            document.onkeydown = (e) => {
                if (e.key === " " && able == true) {
                    shoot(t1, damage);
                    setTimeout(() => {
                        able = true;
                    }, timeoff);

                }
                if(e.key === "r" && able === true){
                    document.ondrag = (e)=> {
                        tower.style.left = e.clientX;
                    }
            }
        }
    }
        if (t1 === "air") {
            var damage = 2;
            var timeoff = 10000;
            var poison = false;
            var able = false;
            var rebound = 20;
            setTimeout(() => {
                able = true;
            }, timeoff);
            document.onkeydown = (e) => {
                if (e.key === " " && able == true) {
                    able = false;
                    defend(rebound);
                    setTimeout(() => {
                        able = true;
                    }, timeoff);

                }
                if(e.key === "r" && able === true){
                    tower.ondrag = (e)=> {
                        tower.style.left = e.clientX + "px";
                    }
                }
            }
        }
    </script>
</body>

</html>